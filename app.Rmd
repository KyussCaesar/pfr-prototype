---
title: "PFR Prototype 1"
output:
  flexdashboard::flex_dashboard:
    theme: yeti
    orientation: rows
    
runtime: shiny
---

```{r global, include=FALSE}
message("Loading libraries")
library(flexdashboard)
library(shiny)

options(error = function() traceback(3))
  
message("Loading globals")

# Load the storage backend
source("backend/session.R")
```

Transactions Page
=====================================================================

Add a transaction {.sidebar data-width=300}
---------------------------------------------------------------------

### Add a transaction

```{r}
textInput("name", "What's the name of this transaction?")

radioButtons("type", "Is this income or expenditure?",
  choices = list("Income" = "income", "Expenditure" = "expense")
)

numericInput("amount", "What is the value of this transaction?", NA)

radioButtons("freq", "How often does this transaction occur?",
  choices = list(
    "Once per day" = "daily",
    "Once per workday (Mon-Fri)" = "workdays",
    "Once per week" = "weekly",
    "Once per month" = "monthly",
    "Once per year" = "yearly"
  )
)

actionButton("submit", "Add Transaction", class = "btn-primary")

observeEvent(input$submit, {
  add_record(input$name, input$type, input$amount, input$freq)
  message("response submitted")
})
```

### Remove a transaction

```{r}
numericInput("trns_rm_id", "Enter the transaction ID to remove", NA)

actionButton("trns_rm", "Remove Transaction", class = "btn-primary")

observeEvent(input$trns_rm, {
  rm_record(input$trns_rm_id)
  message("response submitted")
})
```

Transactions Table Row 
---------------------------------------------------------------------

### Transactions Table

```{r}
renderTable({
  message("updating table")
  get_transactions()
})
```

Summary Boxes Row
---------------------------------------------------------------------

### Transactions recorded

```{r}
renderValueBox({
  valueBox(get_num_transactions())
})
```

### Monthly Income

```{r}
renderValueBox({
  mthly = get_mthly_income()
  valueBox(sprintf("$%.2f", mthly))
})
```

### Monthly Expenses

```{r}
renderValueBox({
  mthly = get_mthly_expense()
  valueBox(sprintf("$%.2f", mthly))
})
```

### Monthly Net

```{r}
renderValueBox({
  mthly = get_mthly_income() - get_mthly_expense()

  valueBox(
    sprintf("$%.2f", mthly),
    color = ifelse(mthly <= 0, "warning", "primary")
  )
})
```

Monthly Report
=====================================================================

```{r}
renderText("Coming Soon!")
```
